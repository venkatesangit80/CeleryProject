import pandas as pd
import io
import uuid
from smbprotocol.connection import Connection
from smbprotocol.session import Session
from smbprotocol.tree import TreeConnect
from smbprotocol.file import Open, CreateDisposition, FileAttributes, FileInformationClass

# Sample DataFrame
data = {
    'Name': ['Alice', 'Bob', 'Charlie'],
    'Age': [25, 30, 35],
    'City': ['New York', 'Los Angeles', 'Chicago']
}
df = pd.DataFrame(data)

# Connection parameters
server_name = "your_server_name"
server_ip = "your_server_ip"
username = "your_username"
password = "your_password"
share_name = "your_share_name"
file_path = "path/to/your/file.csv"

# Convert DataFrame to CSV in memory
csv_buffer = io.StringIO()
df.to_csv(csv_buffer, index=False)
csv_data = csv_buffer.getvalue().encode('utf-8')

# Establish a connection
connection = Connection(uuid.uuid4(), server_ip)
connection.connect()

# Create a session with NTLM authentication
session = Session(connection, username, password)
session.connect()

# Connect to the share
tree = TreeConnect(session, f"\\\\{server_name}\\{share_name}")
tree.connect()

# Open the file for writing
file = Open(tree, file_path, access=0x0012019F, disposition=CreateDisposition.FILE_OVERWRITE_IF, file_attributes=FileAttributes.FILE_ATTRIBUTE_NORMAL)
file.create()

# Write data to the file
file.write(csv_data, 0)
file.set_information(FileInformationClass.FileEndOfFileInformation, {'EndOfFile': len(csv_data)})

# Close the file and disconnect
file.close()
tree.disconnect()
session.disconnect()
connection.disconnect()